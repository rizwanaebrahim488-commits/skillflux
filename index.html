 <!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>SkillFlux | Member Dashboard</title>
    <style>
        :root { --bg: #000; --blue: #3b82f6; --border: #1e293b; --gray: #94a3b8; }
        body { font-family: 'Inter', sans-serif; background: var(--bg); color: white; padding: 120px 8% 50px; }
        nav { position: fixed; top: 0; left: 0; width: 100%; height: 90px; display: flex; justify-content: space-between; align-items: center; padding: 0 8%; background: rgba(0,0,0,0.9); border-bottom: 1px solid var(--border); z-index: 1000; box-sizing: border-box; }
        
        .stat-card { background: #0a0a0a; border: 1px solid var(--blue); padding: 40px; border-radius: 30px; text-align: center; min-width: 250px; box-shadow: 0 10px 30px rgba(59, 130, 246, 0.2); }
        .stat-card h1 { font-size: 5rem; margin: 0; color: var(--blue); line-height: 1; }
        
        .upload-section { background: #0a0a0a; border: 1px solid var(--border); padding: 50px; border-radius: 30px; margin: 50px 0; }
        .upload-section h2 { font-size: 2.5rem; margin-bottom: 20px; }
        
        .skill-feed { display: grid; grid-template-columns: repeat(auto-fill, minmax(350px, 1fr)); gap: 25px; margin-top: 30px; }
        .skill-card { background: #0a0a0a; border: 1px solid var(--border); padding: 30px; border-radius: 20px; border-left: 8px solid var(--blue); display: flex; flex-direction: column; justify-content: space-between; }
        .skill-card strong { font-size: 1.5rem; display: block; margin-bottom: 10px; }
        
        input { padding: 20px; width: 400px; border-radius: 15px; border: 1px solid var(--border); background: #000; color: white; font-size: 1.2rem; margin-right: 15px; outline: none; }
        .btn { background: var(--blue); color: white; border: none; padding: 20px 40px; border-radius: 15px; cursor: pointer; font-weight: 900; font-size: 1.1rem; }
    </style>
</head>
<body>
    <nav>
        <div style="font-size: 2rem; font-weight: 900;">Skill<span style="color:var(--blue)">Flux</span></div>
        <button onclick="auth.signOut()" class="btn" style="background:#ef4444; padding: 10px 20px;">Disconnect</button>
    </nav>

    <div style="display: flex; justify-content: space-between; align-items: center;">
        <div>
            <p style="color:var(--gray); letter-spacing: 5px; font-weight: bold;">VAULT IDENTITY</p>
            <h2 id="user-email" style="font-size: 2.5rem; margin: 0;">Verified Operator</h2>
        </div>
        <div class="stat-card">
            <small style="font-weight:bold; letter-spacing: 2px;">FLUX CREDITS</small>
            <h1 id="user-credits">0</h1>
        </div>
    </div>

    <div class="upload-section">
        <h2>Upload Skill</h2>
        <p style="color:var(--gray); margin-bottom: 30px;">Contribute to the network liquidity by listing your professional expertise.</p>
        <div style="display: flex;">
            <input type="text" id="skillIn" placeholder="Expertise Title (e.g. UI/UX Architecture)">
            <button id="uploadBtn" class="btn">Post to Marketplace</button>
        </div>
    </div>

    <h2 style="font-size: 2.5rem;">Global Exchange Feed</h2>
    <div id="feed" class="skill-feed"></div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
        import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-auth.js";
        import { getFirestore, doc, onSnapshot, collection, addDoc, query, orderBy, runTransaction } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyCHSJX5F_mZjLqPSuofyBANQ3pC69gC14o",
            authDomain: "skillflux-c4088.firebaseapp.com",
            projectId: "skillflux-c4088",
            storageBucket: "skillflux-c4088.appspot.com",
            messagingSenderId: "347039323368",
            appId: "1:347039323368:web:0f610227dc3715581a255d"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);
        window.auth = auth;

        let currentCredits = 0;

        onAuthStateChanged(auth, (user) => {
            if (!user) window.location.href = "index.html";
            else {
                document.getElementById('user-email').innerText = user.email;
                onSnapshot(doc(db, "users", user.uid), (s) => { 
                    if(s.exists()) {
                        currentCredits = s.data().credits;
                        document.getElementById('user-credits').innerText = currentCredits;
                    }
                });
                loadFeed();
            }
        });

        // UPLOAD SKILL
        document.getElementById('uploadBtn').onclick = async () => {
            const skill = document.getElementById('skillIn').value;
            if(skill) {
                await addDoc(collection(db, "skills"), { skill, owner: auth.currentUser.email, ownerId: auth.currentUser.uid, time: new Date() });
                document.getElementById('skillIn').value = '';
            }
        };

        // ACQUIRE SKILL
        window.acquireSkill = async (ownerId) => {
            if(ownerId === auth.currentUser.uid) return alert("Operator cannot acquire self-owned assets.");
            if(currentCredits < 1) return alert("Insufficient Flux Credits.");

            try {
                await runTransaction(db, async (transaction) => {
                    const userRef = doc(db, "users", auth.currentUser.uid);
                    transaction.update(userRef, { credits: currentCredits - 1 });
                });
                alert("Knowledge Asset Acquired. 1 Credit Deducted.");
            } catch (e) { alert(e.message); }
        };

        function loadFeed() {
            const q = query(collection(db, "skills"), orderBy("time", "desc"));
            onSnapshot(q, (snap) => {
                const f = document.getElementById('feed');
                f.innerHTML = '';
                snap.forEach(d => {
                    const data = d.data();
                    f.innerHTML += `
                        <div class="skill-card">
                            <div>
                                <strong>${data.skill}</strong>
                                <p style="color:var(--gray); font-size: 0.9rem;">Operator ID: ${data.owner}</p>
                            </div>
                            <button onclick="acquireSkill('${data.ownerId}')" class="btn" style="margin-top:20px; font-size: 0.9rem; padding:15px;">Acquire (1 Credit)</button>
                        </div>`;
                });
            });
        }
    </script>
</body>
</html>
